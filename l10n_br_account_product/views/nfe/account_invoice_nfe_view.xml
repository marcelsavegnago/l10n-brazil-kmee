<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="l10n_br_account_product_nfe_search" model="ir.ui.view">
            <field name="name">l10n_br_account_product.nfe.search</field>
            <field name="model">account.invoice</field>
            <field name="arch" type="xml">
                <search string="Pesquisar NFe">
                    <field name="number" string="NFe" filter_domain="['|','|','|', ('number','ilike',self), ('origin','ilike',self), ('supplier_invoice_number', 'ilike', self), ('partner_id', 'child_of', self)]"/>
                    <filter name="draft" string="Provisorio" domain="[('state','=','draft')]" help="Draft Invoices"/>
                    <filter name="proforma" string="Proforma" domain="[('state','=','proforma2')]" help="Proforma Invoices" groups="account.group_proforma_invoices"/>
                    <filter icon="terp-check" string="Exportada Receita" domain="[('state','=','sefaz_export')]" />
                    <filter name="invoices" string="Invoices" domain="[('state','not in',['draft','cancel'])]" help="Proforma/Open/Paid Invoices"/>
                    <filter name="unpaid" string="Unpaid" domain="[('state','=','open')]" help="Unpaid Invoices"/>
                    <filter name="customer" string="Customer" domain="[('type','in',('out_invoice','out_refund'))]" help="Only show Client Invoices."/>
                    <filter name="supplier" string="Supplier" domain="[('type','in',('in_invoice','in_refund'))]" help="Only show Supplier Invoices."/>
                    <separator/>
                    <field name="partner_id" operator="child_of"/>
                    <field name="user_id" string="Salesperson"/>
                    <field name="period_id" string="Period"/>
                    <separator/>
                    <filter domain="[('user_id','=',uid)]" help="My Invoices"/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_partner_id" string="Partner" context="{'group_by':'partner_id'}"/>
                        <filter string="Salesperson" context="{'group_by':'user_id'}"/>
                        <filter string="Status" context="{'group_by':'state'}"/>
                        <filter string="Tipo de Documento" context="{'group_by':'type'}"/>
                        <separator/>
                        <filter string="Period" context="{'group_by':'period_id'}"/>
                        <filter string="Due Month" context="{'group_by':'date_due'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="l10n_br_account_product_nfe_tree" model="ir.ui.view">
            <field name="name">l10n_br_account_product.nfe.tree</field>
            <field name="model">account.invoice</field>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';black:state in ('proforma','proforma2','open');gray:state == 'cancel'" string="NFe">
                    <field name="partner_id" groups="base.group_user"/>
                    <field name="commercial_partner_id" invisible="1"/>
                    <field name="date_invoice"/>
                    <field name="number"/>
                    <field name="reference" invisible="1"/>
                    <field name="name" invisible="1"/>
                    <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                    <field name="origin"/>
                    <field name="amount_untaxed" sum="Untaxed Amount"/>
                    <field name="amount_total" sum="Total Amount"/>
                    <field name="amount_wh" widget="monetary" options="{'currency_field': 'currency_id'}" />
                           <!--attrs="{'invisible': [('fiscal_type', '!=', 'service')]}"-->
                    <field name="state"/>
                    <field name="type" invisible="context.get('type',True)"/>
                </tree>
            </field>
        </record>

        <record id="l10n_br_account_product_nfe_form" model="ir.ui.view">
            <field name="name">l10n_br_account_product.nfe.form</field>
            <field name="model">account.invoice</field>
            <field name="arch" type="xml">
                <form string="NF-e">
                <header>
                    <button name="action_invoice_sent" type="object" string="Send by Email" attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}" class="oe_highlight" groups="base.group_user"/>
                    <button name="invoice_print" string="Print" type="object" attrs="{'invisible':['|',('sent','=',True), ('state', '!=', 'open')]}" class="oe_highlight" groups="base.group_user"/>
                    <button name="action_invoice_sent" type="object" string="Send by Email" attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="invoice_print" string="Print Invoice" type="object" attrs="{'invisible':['|',('sent','=',False), ('state', '!=', 'open')]}" groups="base.group_user"/>
                    <button name="invoice_validate" states="draft" string="Confirmar" class="oe_highlight" groups="base.group_user"/>
                    <button name="invoice_open" states="sefaz_export,proforma2" string="Validate" class="oe_highlight" groups="base.group_user"/>
                    <button name="invoice_open" states="proforma2" string="Validate" groups="base.group_user"/>
                    <button name="invoice_proforma2" states="draft" string="PRO-FORMA" groups="account.group_proforma_invoices"/>
                    <button name="%(account.action_account_invoice_refund)d" type='action' string='Refund Invoice' states='open,proforma2,paid' groups="base.group_user"/>
                    <button name="invoice_cancel" states="draft,proforma2,open" string="Cancel Invoice" groups="base.group_no_one"/>
                    <button name="action_cancel_draft" states="cancel" string="Reset to Draft" type="object" groups="base.group_user"/>
                    <button name='%(account.action_account_state_open)d' type='action' string='Re-Open' groups="account.group_account_invoice" attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}" help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created."/>
                    <field name="state" widget="statusbar" nolabel="1" statusbar_visible="draft,open,paid" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                </header>
                <sheet string="NF-e">
                    <h1>
                        <label string="NF-e" attrs="{'invisible': [('state','in',('draft','proforma','proforma2'))]}"/>
                        <label string="Nova NF-e" attrs="{'invisible': [('state','not in',('draft',))]}"/>
                    </h1>
                    <field name="sent" invisible="1"/>
                    <field name="fiscal_type" invisible="1"/>
                    <field name="fiscal_document_electronic" invisible="1"/>
                    <group>
                        <group>
                            <field name="type" required="1"/>
                            <field name="nfe_purpose" required="1"/>
                            <field name="fiscal_document_id" required="1"/>
                            <field name="document_serie_id" domain="[('fiscal_type','=','product'),('fiscal_document_id','=',fiscal_document_id),('company_id','=',company_id)]" attrs="{'invisible': [('issuer', '=', '1')], 'required': [('issuer', '=', '0')]}" />
                            <field name="issuer" attrs="{'invisible': [('type', '=', 'out_invoice')]}" />
                            <field name="serie_nfe" attrs="{'invisible': [('issuer', '=', '0')]}" />
                        </group>
                        <group>
                            <field name="internal_number" attrs="{'readonly': [('issuer', '=', '0')], 'required': [('issuer', '=', '1')]}" />
                            <field name="date_invoice" invisible="1" on_change="onchange_payment_term_date_invoice(payment_term, date_invoice)"/>
                            <field name="date_hour_invoice" string="Data Emissão" attrs="{'required': [('type', 'in', ['in_invoice', 'in_refund'])]}"/>
                            <field name="date_in_out" string="Data de Entrada/Saida" attrs="{'required': [('type', 'in', ['in_invoice', 'in_refund'])]}"/>
                            </group>
                    </group>
                    <separator string="Parceiro" />
                    <group>
                        <field name="partner_id"
                                on_change="onchange_partner_id(type, partner_id, date_invoice, payment_term, partner_bank_id, company_id, context)"
                                context="{'search_default_customer':1, 'show_address': 1, 'fiscal_category_id': fiscal_category_id}"
                                options="{'always_reload': True, 'no_quick_create': True, 'no_create_edit': True}" />
                        <field name="partner_shipping_id" domain="[('parent_id', '=', partner_id)]"
                            context="{'default_type':'delivery', 'show_address': 1}" options="{'always_reload': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                    </group>
                    <separator string="Fiscal" />
                    <group>
                        <field name="fiscal_category_id" domain="[('type','in',{'out_invoice': ['output'], 'out_refund': ['input'], 'in_refund': ['output'], 'in_invoice': ['input']}.get(type, [])),('fiscal_type','=','product')]" required="1" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                        <field name="fiscal_position" required="1" domain="[('fiscal_category_id', '=', fiscal_category_id)]" groups="base.group_extended,base.group_user" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                        <field name="ind_final" string="Operação com Consumidor final" attrs="{'required': [('nfe_version', '>', '3.00')]}"/>
                        <field name="ind_pres" string="Tipo de operação" attrs="{'required': [('nfe_version', '>', '3.00')]}"/>
                        <field name="check_total" groups="account.group_supplier_inv_check_total" attrs="{'invisible': [('type', 'in', ('out_invoice', 'out_refund'))]}"/>
                    </group>
                    <separator string="Sefaz" />
                    <group>
                        <group>
                            <field name="nfe_access_key" attrs="{'readonly': [('issuer', '=', '0')]}" />
                            <field name="nfe_status"/>
                        </group>
                        <group>
                            <field name="nfe_version" attrs="{'readonly': [('issuer', '=', '0')]}" />
                            <field name="nfe_date" />
                            <field name="nfe_protocol_number" attrs="{'readonly': [('issuer', '=', '0')]}"/>
                        </group>
                    </group>
                    <notebook colspan="4">
                        <page string="Produtos e Serviços">
                            <field name="invoice_line" nolabel="1" widget="one2many_list" context="{'type': type, 'fiscal_type': 'product', 'partner_id': partner_id, 'company_id': company_id, 'form_view_ref': 'l10n_br_account_product.l10n_br_account_product_nfe_line_form'}">
                                <tree string="Invoice Lines">
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"
                                        domain="[('fiscal_type', 'in', ('product', 'service'))]"
                                        on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)" context_br="{'parent_fiscal_category_id': parent.fiscal_category_id, 'parent_fiscal_position': parent.fiscal_position}"/>
                                        <!--domain="[('fiscal_type', '=', 'product')]"-->
                                    <field name="name"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="fiscal_category_id" invisible="1"/>
                                    <field name="cfop_id"/>
                                    <field name="account_id" invisible="1" groups="account.group_account_user"
                                        domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]"
                                        on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position,account_id)"/>
                                    <field name="quantity"/>
                                    <field name="price_unit"/>
                                    <field name="uos_id" groups="product.group_uom"
                                        on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"/>
                                    <field name="price_gross"/>
                                    <field name="discount" groups="sale.group_discount_per_so_line"/>
                                    <field name="invoice_line_tax_id" invisible="1" widget="many2many_tags" context="{'type':parent.type}"
                                        domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]"/>
                                    <field name="price_subtotal"/>
                                    <field name="price_total"/>
                                </tree>
                            </field>
                            <notebook>
                                <page string="Totais" name="page_invoice_totals">
                                    <group string="Valores Principais">
                                        <group>
                                            <field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="amount_freight" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="amount_insurance" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="amount_costs" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="amount_discount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="vr_operacao" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                        </group>
                                        <group>
                                            <button name="button_reset_taxes" states="draft,proforma2"
                                                string="(update)" class="oe_link oe_edit_only"
                                                type="object" help="Recompute taxes and total"/>
                                            <newline/>
                                            <label for="currency_id" groups="base.group_multi_currency"/>
                                            <div groups="base.group_multi_currency">
                                                <field name="currency_id" class="oe_inline"/>
                                                <button name="%(account.action_account_change_currency)d" type="action"
                                                  class="oe_inline oe_link oe_edit_only"
                                                  string="(change)"
                                                  attrs="{'invisible':[('state','!=','draft')]}"
                                                  groups="account.group_account_user"/>
                                            </div>
                                            <field name="amount_total" string="Total da NF" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>

                                            <field name="company_currency_id" options="{'no_open': True, 'no_create': True}"/>
                                            <field name="amount_company_currency" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
                                            <field name="amount_net" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
                                            <newline/>
                                        </group>
                                    </group>
                                </page>
                                <page string="Impostos" name="page_invoice_taxes">
                                     <notebook>
                                        <page string="ICMS" name="page_invoice_taxes_icms">
                                            <group>
                                                <group string="ICMS">
                                                    <field name="icms_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="icms_base_other" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="icms_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                                <group string="ICMS ST">
                                                    <field name="icms_st_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="icms_st_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                            </group>
                                            <group>
                                                <group string="Diferencial de alíquota">
                                                    <field name="icms_dest_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="icms_origin_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                                <group string="Fundo de combate a probreza">
                                                    <field name="icms_fcp_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                            </group>
                                        </page>
                                        <page string="IPI" name="page_invoice_taxes_ipi">
                                            <group string="Detalhes do IPI">
                                                <group>
                                                    <field name="ipi_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="ipi_base_other" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="ipi_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                            </group>
                                        </page>
                                        <page string="PIS-COFINS" name="page_invoice_taxes_pis_cofins">
                                            <group>
                                                <group string="PIS">
                                                    <field name="pis_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="pis_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                                <group string="COFINS">
                                                    <field name="cofins_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                    <field name="cofins_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                </group>
                                            </group>
                                        </page>
                                        <page string="ISSQN" name="page_invoice_taxes_iss">
                                            <group string="ISSQN">
                                                <field name="issqn_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                <field name="issqn_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            </group>
                                        </page>
                                         <!-- EXIBIR OS CAMPOS RELACIONADOS A TODOS OS IMPOSTOS DE SERVIÇO???? -->
                                        <!--<page string="Serviço" name="page_invoice_taxes_serviço">-->
                                            <!--<group>-->
                                                <!--<group string="ISSQN">-->
                                                    <!--<field name="issqn_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                    <!--<field name="issqn_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                                <!--<group string="CSLL">-->
                                                    <!--<field name="csll_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                    <!--<field name="csll_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                            <!--</group>-->
                                            <!--<group>-->
                                                <!--<group string="PIS">-->
                                                    <!--<field name="service_pis_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                                <!--<group string="COFINS">-->
                                                    <!--<field name="service_cofins_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                            <!--</group>-->
                                            <!--<group>-->
                                                <!--<group string="IR">-->
                                                    <!--<field name="ir_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                    <!--<field name="ir_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                                <!--<group string="INSS">-->
                                                    <!--<field name="inss_base" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                    <!--<field name="inss_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
                                                <!--</group>-->
                                            <!--</group>-->
                                        <!--</page>-->
                                        <page string="II" name="page_invoice_taxes_ii">
                                            <group string="Imposto de Importação">
                                                <field name="ii_value" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            </group>
                                        </page>
                                        <page string="IBPT" name="page_invoice_taxes_ii">
                                            <group string="Valor aproximado dos tributos">
                                                <field name="amount_total_taxes" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            </group>
                                        </page>
                                    </notebook>
                                </page>
                                <page string="Retenções">
                                    <group string="Retenção Impostos sobre serviços:" >
                                        <group>
                                            <field name="issqn_wh" />
                                            <field name="pis_wh" />
                                            <field name="cofins_wh" />
                                            <field name="csll_wh" />
                                            <field name="irrf_wh" />
                                            <field name="inss_wh" />
                                        </group>
                                        <group>
                                            <field name="amount_pis_cofins_csll" invisible="1"/>
                                            <field name="issqn_value_wh" />
                                            <field name="pis_value_wh" />
                                            <field name="cofins_value_wh" />
                                            <field name="csll_value_wh" />
                                            <field name="irrf_base_wh" />
                                            <field name="irrf_value_wh" />
                                            <field name="inss_base_wh" />
                                            <field name="inss_value_wh" />
                                            <newline/>
                                            <field name="amount_wh" />
                                            <button name="button_reset_taxes" states="draft,proforma2" string="(update)" class="oe_link oe_edit_only" type="object" help="Recompute taxes and total"/>
                                        </group>
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page string="Financeiro" groups="base.group_user">
                            <group>
                                <group>
                                    <field name="payment_term" class="oe_inline" attrs="{'readonly': [('state', 'in', ['open', 'paid', 'cancel', 'sefaz_cancelled'])]}"/>
                                    <field name="payment_mode_id" domain="[]"/>
                                    <field name="type_nf_payment" attrs="{'required': [('type', '!=', 'in_invoice')]}"/>
                                    <field domain="[('partner_id.ref_companies', 'in', [company_id])]" name="partner_bank_id"/>
                                </group>
                                <group>
                                    <field name="date_due"/>
                                    <field name="residual" groups="account.group_account_user" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    <field name="reconciled" invisible="1"/>
                                </group>
                            </group>
                            <group string="Duplicatas">
                                <!--<field nolabel="1" name="move_line_receivable_id">-->
                                    <!--<tree string="Vencimentos">-->
                                        <!--<field name="journal_id"/>-->
                                        <!--<field name="period_id"/>-->
                                        <!--<field name="date"/>-->
                                        <!--<field name="date_maturity"/>-->
                                        <!--<field name="name"/>-->
                                        <!--<field name="ref"/>-->
                                        <!--<field name="partner_id"/>-->
                                        <!--<field name="move_id"/>-->
                                        <!--<field name="debit"/>-->
                                        <!--<field name="credit"/>-->
                                        <!--<field name="reconcile_ref"/>-->
                                    <!--</tree>-->
                                <!--</field>-->
                                <field name="duplicata_ids" colspan="4" nolabel="1" >
                                    <tree string="Duplicatas" editable="bottom">
                                        <field name="numero" />
                                        <field name="data_vencimento" />
                                        <field name="valor" sum="valor" />
                                    </tree>
                                </field>
                            </group>
                            <page string="Financeiro" name="financial_page">
                            <group cols="4">
                            <field name="financial_ids" colspan="4" nolabel="1">
                                <tree decoration-info="state == 'draft'" decoration-muted="state == 'cancelled'">
                                    <field name="date_business_maturity" string="Maturity"/>
                                    <field name="date_document"/>
                                    <field name="display_name"/>
                                    <!--<field name="partner_id"/>-->
                                    <!--<field name="document_type_id"/>-->
                                    <!--<field name="document_number"/>-->
                                    <field name="currency_id" groups="base.group_multi_currency"/>
                                    <field name="amount_document" sum="Document"/>
                                    <field name="amount_total" sum="Total"/>
                                    <field name="date_payment"/>
                                    <field name="amount_paid_document" sum="Paid"/>
                                    <field name="amount_residual" sum="Residual"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                            </group>
                        </page>
                        </page>
                        <page string="Contábil">
                            <group col="4">
                                <group>
                                    <field name="company_id" on_change="onchange_company_id(company_id,partner_id,type,invoice_line,currency_id)" widget="selection" groups="base.group_multi_company"/>
                                    <field name="journal_id" groups="account.group_account_user"
                                        on_change="onchange_journal_id(journal_id)" options="{'no_create': True}"
                                        attrs="{'readonly':[('internal_number','!=',False)]}" domain="[('type', 'in', {'out_invoice': ['sale'], 'out_refund': ['sale_refund'], 'in_refund': ['purchase_refund'], 'in_invoice': ['purchase']}.get(type, [])), ('company_id', '=', company_id)]"/>
                                    <field domain="[('company_id', '=', company_id), ('type','in',{'out_invoice': ['receivable'], 'out_refund': ['receivable'], 'in_refund': ['payable'], 'in_invoice': ['payable']}.get(type, []))]"
                                        name="account_id" groups="account.group_account_user"
                                        context="{'periods_special': False, 'all_fiscalyear': True}" required="0" invisible="1"/>
                                    <field name="period_id" domain="[('state', '=', 'draft'), ('company_id', '=', company_id)]"
                                        groups="account.group_account_manager"
                                        string="Accounting Period"
                                        placeholder="force period" options="{'no_quick_create': True, 'no_create_edit': True}" />
                                    <field name="move_id" groups="account.group_account_user"/>
                                </group>
                                <group>
                                    <field name="origin" groups="base.group_user"/>
                                    <field name="name"/>
                                    <field name="user_id" groups="base.group_user" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice']}" options="{'no_quick_create': True, 'no_create_edit': True}" />
                                </group>
                            </group>
                            <field name="tax_line">
                                <tree editable="bottom" string="Taxes">
                                    <field name="name"/>
                                    <field name="account_id" groups="account.group_account_user"/>
                                    <field name="base" on_change="base_change(base,parent.currency_id,parent.company_id,parent.date_invoice)" readonly="1"/>
                                    <field name="amount" on_change="amount_change(amount,parent.currency_id,parent.company_id,parent.date_invoice)"/>
                                    <field invisible="True" name="base_amount"/>
                                    <field invisible="True" name="tax_amount"/>
                                    <field name="factor_base" invisible="True"/>
                                    <field name="factor_tax" invisible="True"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Documentos Relacionados">
                            <field colspan="4" nolabel="1" name="fiscal_document_related_ids">
                                <tree>
                                    <field name="document_type"/>
                                    <field name="access_key"/>
                                    <field name="serie"/>
                                    <field name="internal_number"/>
                                </tree>
                                <form string="Documentos Fiscais">
                                    <group col="4">
                                        <field name="invoice_related_id" on_change="onchange_invoice_related_id(invoice_related_id)"/>
                                    </group>
                                    <group col="4">
                                        <field name="document_type"/>
                                    </group>
                                    <group col="4" string="NF-e/CT-e" attrs="{'invisible': [('document_type','in', ('nf', 'nfrural', 'cf', False))]}">
                                        <field name="access_key"/>
                                    </group>
                                    <group col="4" string="Nota Fiscal/Produtor/Cupom Fiscal" attrs="{'invisible': [('document_type', 'in', ('nfe','cte', False))]}">
                                        <field name="serie" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural', 'cf'))]}"/>
                                        <field name="internal_number" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural', 'cf'))]}"/>
                                        <field name="fiscal_document_id" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural', 'cf'))]}"/>
                                        <field name="state_id" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural'))], 'invisible': [('document_type', '=', 'cf')]}"/>
                                        <field name="date" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural'))], 'invisible': [('document_type', '=', 'cf')]}"/>
                                        <field name="cpfcnpj_type" attrs="{'required': [('document_type', 'in', ('nfrural'))], 'invisible': [('document_type', '!=', 'nfrural')]}"/>
                                        <field name="cnpj_cpf" on_change="onchange_mask_cnpj_cpf(cpfcnpj_type, cnpj_cpf)" attrs="{'required': [('document_type', 'in', ('nf', 'nfrural'))], 'invisible': [('document_type', '=', 'cf')]}"/>
                                        <field name="inscr_est" attrs="{'invisible': [('document_type', '!=', 'nfrural')]}"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Dados Adicionais">
                            <notebook>
                                <page string="Documento Fiscal">
                                    <group>
                                        <field name="nfe_export_date"/>
                                        <field name="nfe_date"/>
                                    </group>
                                    <field name="account_document_event_ids"/>
                                </page>
                                <page string="CFOP">
                                    <group string="CFOP">
                                        <field nolabel="1" name="cfop_ids" />
                                    </group>
                                </page>
                                <page string="Transporte">
                                    <div class="oe_right oe_button_box" name="buttons">
                                        <button class="oe_inline oe_stat_button" type="action" name="%(action_l10n_br_account_product_costs_ratio)d" icon="fa-truck">
                                            <div>Recalcular<br/>Custos</div>
                                        </button>
                                    </div>
                                    <group name="shipping_info" string="Informações de Exportação">
                                        <field name="shipping_state_id"/>
                                        <field name="shipping_location"/>
                                        <field name="expedition_location"/>
                                    </group>
                                    <group name="delivery_info">
                                        <field name="carrier_name"/>
                                        <field name="vehicle_plate"/>
                                        <field name="vehicle_state_id"/>
                                        <field name="vehicle_l10n_br_city_id"/>
                                    </group>
                                    <group name="package_info">
                                        <field name="weight"/>
                                        <field name="weight_net"/>
                                        <field name="number_of_packages"/>
                                        <field name="kind_of_packages"/>
                                        <field name="brand_of_packages"/>
                                        <field name="notation_of_packages"/>
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page string="Observações">
                            <group string="Observações">
                                <field name="comment" nolabel="1"/>
                            </group>
                            <group string="Observações Fiscais">
                                <field name="fiscal_comment" nolabel="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>

        <record id="l10n_br_account_product_nfe_line_form" model="ir.ui.view">
            <field name="name">l10n_br_account_product.nfe.line.form</field>
            <field name="model">account.invoice.line</field>
            <field name="arch" type="xml">
                <form string="Produtos e Serviços">
                    <notebook>
                        <page string="General">
                            <separator string="Produto" />
                            <group>
                                <field name="product_id" domain="[('fiscal_type', 'in', ('product', 'service'))]" on_change="product_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, fiscal_position, price_unit, parent.currency_id, parent.company_id, context)" context_br="{'parent_fiscal_category_id': parent.fiscal_category_id, 'parent_fiscal_position': parent.fiscal_position}" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field name="type" invisible="1"/>
                                <field name="nfe_purpose" invisible="1"/>
                            </group>
                            <separator string="Fiscal" />
                            <group>
                                <field name="product_type" attrs="{'readonly': [('product_id','!=', False)]}"/>
                                <field name="code" required="True" attrs="{'readonly': [('product_id','!=', False)]}"/>
                                <field name="fiscal_classification_id" required="True" attrs="{'readonly': [('product_id','!=', False)]}"/>
                                <field name="fiscal_category_id" required="1" domain="[('journal_type', '=', 'sale')]" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field name="fiscal_position" required="1" domain="[('fiscal_category_id', '=', fiscal_category_id)]" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field name="account_move_template_id" required="1" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field name="cfop_id" options="{'no_quick_create': True, 'no_create_edit': True}" invisible="1"/>
                                <field name="cfop_view" />
                                <field name="account_id" required="0" invisible="1"/>
                                <field name="cest_id" attrs="{'readonly': [('product_id','!=', False)]}" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field name="fci" attrs="{'readonly': [('product_id','!=', False)]}"/>
                                <field name="inss_base_wh_reducao" attrs="{'readonly': [('price_unit', '=', 0)]}"/>
                                <field name="invoice_line_tax_id" context="{'type':parent.type}" domain="[('parent_id','=',False),('company_id', '=', parent.company_id)]" widget="many2many_tags" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                <field domain="[('type','&lt;&gt;','view'), ('company_id', '=', parent.company_id)]" name="account_analytic_id" groups="analytic.group_analytic_accounting"/>
                                <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                            </group>
                            <separator string="Detalhes" />
                            <group>
                                <group>
                                    <group string="Quantidade e Preço">
                                        <field name="fiscal_type" invisible="1" />
                                        <label for="quantity"/>
                                        <div>
                                            <field name="quantity" class="oe_inline"/>
                                            <field name="uos_id" class="oe_inline" groups="product.group_uom" on_change="uos_id_change(product_id, uos_id, quantity, name, parent.type, parent.partner_id, parent.fiscal_position, price_unit, parent.currency_id, parent.company_id, context)"/>
                                        </div>
                                        <field name="price_unit"/>
                                        <field name="discount"/>
                                        <field name="freight_value"/>
                                        <field name="insurance_value"/>
                                        <field name="other_costs_value"/>
                                    </group>
                                    <group string="Custos e Totais">
                                        <field name="vr_custo_comercial"/>
                                        <field name="vr_custo_estoque"/>
                                        <field name="vr_operacao"/>
                                        <field name="price_subtotal"/>
                                        <field name="price_total"/>
                                    </group>
                                </group>
                            </group>

                            <label for="name"/>
                            <field name="name"/>
                        </page>
                        <page position="inside" string="Impostos">
                            <group>
                                <field name="total_taxes"/>
                            </group>
                            <notebook>
                                <page string="ICMS" attrs="{'invisible': [('product_type', '=', 'service')]}">
                                    <group string="Detalhes do ICMS">
                                        <group>
                                            <field name="icms_manual" invisible="True"/>
                                            <field name="icms_cst_id" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                            <field name="icms_origin"/>
                                            <field name="icms_base_type"/>
                                            <field name="icms_base"/>
                                            <field name="icms_percent_reduction"/>
                                        </group>
                                        <group>
                                            <field name="icms_relief_id" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                            <field name="icms_base_other"/>
                                            <field name="icms_percent"/>
                                            <field name="icms_value"/>
                                        </group>
                                    </group>
                                    <group string="Substituição Tributária ICMS">
                                        <group>
                                            <field name="icms_st_base_type"/>
                                            <field name="icms_st_base"/>
                                            <field name="icms_st_percent_reduction"/>
                                            <field name="icms_st_base_other"/>
                                        </group>
                                        <group>
                                            <field name="icms_st_percent"/>
                                            <field name="icms_st_mva"/>
                                            <field name="icms_st_value"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="ISSQN" attrs="{'invisible': [('product_type','!=', 'service')]}">
                                    <group>
                                        <field name="issqn_manual" invisible="True"/>
                                        <field name="issqn_base"/>
                                        <field name="issqn_percent"/>
                                        <field name="service_type_id" attrs="{'required': [('product_type','=', 'service')]}" domain="[('internal_type','=','normal')]" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                        <field name="issqn_exigibilidade"/>
                                        <field name="issqn_suspension_process"
                                               attrs="{'invisible': [('issqn_exigibilidade','not in', ['6','7'])]}"/>
                                        <field name="issqn_value"/>
                                        <field name="issqn_wh_value" invisible="0"/>

                                    </group>
                                </page>
                                <page string="IPI" attrs="{'invisible': [('product_type','=', 'service')]}">
                                    <group string="Detalhes do IPI">
                                        <group>
                                            <field name="ipi_manual" invisible="True"/>
                                            <field name="ipi_cst_id" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                            <field name="ipi_type"/>
                                            <field name="ipi_base"/>
                                        </group>
                                        <group>
                                            <field name="ipi_guideline_id" options="{'no_quick_create': True, 'no_create_edit': True}"/>
                                            <field name="ipi_base_other"/>
                                            <field name="ipi_percent"/>
                                            <field name="ipi_value"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="PIS">
                                    <group string="Detalhes do PIS">
                                        <group>
                                            <field name="pis_manual" invisible="True"/>
                                            <field name="pis_cst_id" attrs="{'required': [('type', '=', 'out_invoice')]}"/>
                                            <!--attrs="{'required': [('product_type','in', ('product', 'service'))]}"-->
                                            <field name="pis_type"/>
                                            <field name="pis_base"/>
                                        </group>
                                        <group>
                                            <field name="pis_percent"/>
                                            <field name="pis_value"/>
                                            <field name="pis_wh_value" invisible="0"/>
                                        </group>
                                    </group>
                                    <group string="Detalhes do PIS ST">
                                        <group>
                                            <field name="pis_st_type"/>
                                            <field name="pis_st_base"/>
                                        </group>
                                        <group>
                                            <field name="pis_st_percent"/>
                                            <field name="pis_st_value"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="COFINS">
                                    <group string="Detalhes do COFINS">
                                        <group>
                                            <field name="cofins_manual" invisible="True"/>
                                            <field name="cofins_cst_id" attrs="{'required': [('type', '=', 'out_invoice')]}"/>
                                            <!--attrs="{'required': [('product_type','in', ('product', 'service'))]}"-->
                                            <field name="cofins_type"/>
                                            <field name="cofins_base"/>
                                            <field name="cofins_wh_value" invisible="0"/>
                                        </group>
                                        <group>
                                            <field name="cofins_percent"/>
                                            <field name="cofins_value"/>
                                        </group>
                                    </group>
                                    <group string="Detalhes do COFINS ST">
                                        <group>
                                            <field name="cofins_st_type"/>
                                            <field name="cofins_st_base"/>
                                        </group>
                                        <group>
                                            <field name="cofins_st_percent"/>
                                            <field name="cofins_st_value"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="II" attrs="{'invisible': [('product_type','=', 'service')]}">
                                    <group string="Detalhes do Imposto de Importação">
                                        <field name="ii_base"/>
                                        <field name="ii_customhouse_charges"/>
                                        <field name="ii_iof"/>
                                        <field name="ii_value"/>
                                    </group>
                                </page>
                                <page string="CSLL">
                                    <group>
                                        <field name="csll_base"/>
                                        <field name="csll_percent"/>
                                        <field name="csll_value"/>
                                        <field name="csll_wh_value" invisible="0"/>
                                    </group>
                                </page>
                                <page string="IR">
                                    <group>
                                        <field name="ir_base"/>
                                        <field name="ir_percent"/>
                                        <field name="ir_value"/>
                                        <field name="ir_wh_value" invisible="0"/>
                                        <field name="inss_base" invisible="0"/>
                                        <field name="inss_wh_value" invisible="0"/>
                                    </group>
                                </page>
                            </notebook>
                        </page>
                        <page string="Informações Adicionais">
                            <group string="Informação de interesse do emissor para controle do B2B">
                                <group>
                                    <field name="partner_order"/>
                                </group>
                                <group>
                                    <field name="partner_order_line"/>
                                </group>
                                <group string="Observações Fiscais">
                                    <field name="fiscal_comment" nolabel="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Declaração de Importação">
                            <group>
                                <field name="import_declaration_ids" colspan="4" nolabel="1">
                                    <tree>
                                        <field name="name"/>
                                        <field name="date_registration"/>
                                        <field name="exporting_code"/>
                                        <field name="state_id"/>
                                        <field name="location"/>
                                        <field name="date_release"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="l10n_br_account_product_nfe_output_action" model="ir.actions.act_window">
            <field name="name">NF-e Saída</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','=','out_invoice')]</field>
            <field name="context">{'default_type':'out_invoice', 'type':'out_invoice', 'journal_type': 'sale', 'fiscal_document_code': '55', 'fiscal_type': 'product'}</field>
            <field name="search_view_id" ref="l10n_br_account_product_nfe_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click para criar uma nova Nota Fiscal Eletrônica.
              </p><p>
                Odoo's electronic invoicing allows to ease and fasten the
                collection of customer payments. Your customer receives the
                invoice by email and he can pay online and/or import it
                in his own system.
              </p><p>
                The discussions with your customer are automatically displayed at
                the bottom of each invoice.
              </p>
            </field>
        </record>

        <record id="l10n_br_account_product_nfe_input_action" model="ir.actions.act_window">
            <field name="name">NF-e Entrada</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','=','in_invoice')]</field>
            <field name="context">{'default_type':'in_invoice', 'default_issuer': '1', 'issuer': '1', 'type':'in_invoice', 'journal_type': 'purchase', 'fiscal_document_code': '55'}</field>
            <field name="search_view_id" ref="l10n_br_account_product_nfe_search"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click para criar uma nova Nota Fiscal Eletrônica.
              </p><p>
                Odoo's electronic invoicing allows to ease and fasten the
                collection of customer payments. Your customer receives the
                invoice by email and he can pay online and/or import it
                in his own system.
              </p><p>
                The discussions with your customer are automatically displayed at
                the bottom of each invoice.
              </p>
            </field>
        </record>

        <menuitem id="l10n_br_account_product_nfe_input_menu" action="l10n_br_account_product_nfe_input_action" parent="l10n_br_account.menu_fiscal_document" sequence="10"/>
        <menuitem id="l10n_br_account_product_nfe_output_menu" action="l10n_br_account_product_nfe_output_action" parent="l10n_br_account.menu_fiscal_document" sequence="11"/>

    </data>
</openerp>
